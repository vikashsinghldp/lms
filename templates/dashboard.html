<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <title>User Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
	<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">

    <link rel="stylesheet" href="{% static 'style.css' %}">

</head>
<body>

<section id="sidebar">
		<a href="#" class="brand">
			<i class='bx bxs-smile'></i>
			<span class="text">CodingMaster</span>
		</a>
		<ul class="side-menu top">
			<li class="active">
				<a href="#">
					<i class='bx bxs-dashboard'></i>
					<span class="text">Dashboard</span>
				</a>
			</li>
			<li>
				<a href="#">
					<i class='bx bxs-shopping-bag-alt'></i>
					<span class="text">My Courses</span>
				</a>
			</li>
			<li>
				<a href="../profile/">
					<i class='bx bxs-doughnut-chart'></i>
					<span class="text">Profile</span>
				</a>
			</li>
			<li>
				<a href="{% url 'course_resources' 1 %}">
					<i class='bx bxs-message-dots'></i>
					<span class="text">Resources</span>
				</a>
			</li>
			<li>
				<a href="#">
					<i class='bx bxs-group'></i>
					<span class="text">Certificates</span>
				</a>
			</li>
		</ul>
		<ul class="side-menu">
			<li>
				<a href="../profile/settings/">
					<i class='bx bxs-cog'></i>
					<span class="text">Settings</span>
				</a>
			</li>
			<li>
				<a href="../logout" class="logout">
					<i class='bx bxs-log-out-circle'></i>
					<span class="text">Logout</span>
				</a>
			</li>
		</ul>
	</section>
	<!-- SIDEBAR -->

	<!-- CONTENT -->
	<section id="content">
		<!-- NAVBAR -->
		<nav>
			<i class='bx bx-menu'></i>
			<a href="#" class="nav-link">Categories</a>
			<form action="#">
				<div class="form-input">
					<input type="search" placeholder="Search...">
					<button type="submit" class="search-btn"><i class='bx bx-search'></i></button>
				</div>
			</form>
			<input type="checkbox" id="switch-mode" hidden>
			<label for="switch-mode" class="switch-mode"></label>
			<a href="#" class="notification">
				<i class='bx bxs-bell'></i>
				<span class="num">8</span>
			</a>
			
		</nav>
		<!-- NAVBAR -->

		<!-- MAIN -->
		<main>
			<div class="head-title">
				<div class="left">
					<h1>Dashboard</h1>
					<ul class="breadcrumb">
						<li>
							<a href="#">Dashboard</a>
						</li>
						<li><i class='bx bx-chevron-right'></i></li>
						<li>
							<a class="active" href="#">Home</a>
						</li>
					</ul>
				</div>
				<a href="#" class="btn-download">
					<i class='bx bxs-cloud-download'></i>
					<span class="text">Download PDF</span>
				</a>
			</div>
			<div class="container mt-4">
				<h3 class="mb-4">My Enrolled Courses</h3>

				{% if enrollments %}
				<div class="row">
					{% for enroll in enrollments %}
					<div class="col-md-4">
						<div class="card shadow-sm mb-4">
							<img src="{{ enroll.image.url }}" class="card-img-top">

							<div class="card-body">
								<h6 class="card-title">
									{{ enroll.course.title }}
								</h6>

								<p class="card-text">
									<!-- {{ enroll.course.description|truncatechars:80 }} -->
								</p>

								<p class="text-muted small">
									Enrolled on: {{ enroll.enrolled_at|date:"d M Y" }}
								</p>

								<a href="{% url 'course_lessons' enroll.course.id %}" class="btn btn-primary btn-sm">
									Continue Learning
								</a>
							</div>
						</div>
					</div>
					{% endfor %}
				</div>
				{% else %}
				<div class="alert alert-info">
					You have not enrolled in any course yet.
				</div>
				{% endif %}
			</div>

			<!-- Courses to Enroll -->
			<div class="mb-4 table-data">
				<h4 class="mb-3">Courses You Can Enroll</h4>
				<div class="row g-4">
					{% for course in courses %}

					<div class="col-md-6">
						<div class="card h-100 shadow-sm">
							{% if course.image %}
        <img src="{{ course.image.url }}" class="card-img-top" alt="{{ course.title }}">
        {% endif %}
							<div class="card-body">
								
								<h6 class="card-title fs-6">{{ course.title }}</h6>
								<p class="card-text small text-muted mb-2">{{ course.description|truncatechars:90 }}</p>
								<span class="badge bg-success mb-2">Beginner</span>
							</div>
							<div class="card-footer bg-white">
								<button class="btn btn-primary enroll-btn" data-course="{{ course.id }}">
									Enroll Now
								</button>
							</div>
						</div>
					</div>
{% empty %}
<p class="text-center">No courses available</p>
{% endfor %}

					


				</div>

			</div>
			</div>


			
		</main>
		<!-- MAIN -->
	</section>
	<!-- CONTENT -->


	<script src="{% static 'script.js' %}"></script>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function toggleSidebar(){
        document.getElementById('sidebar').classList.toggle('show');
    }
</script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
document.querySelectorAll(".enroll-btn").forEach(btn => {
    btn.onclick = function () {
        let courseId = this.dataset.course;

        fetch("/create-order/", {
            method: "POST",
            headers: {
                "X-CSRFToken": "{{ csrf_token }}"
            },
            body: new URLSearchParams({
                course_id: courseId
            })
        })
        .then(res => res.json())
        .then(data => {
            var options = {
                "key": data.key,
                "amount": data.amount * 100,
                "currency": "INR",
                "name": "Coding Academy",
                "description": data.course,
                "order_id": data.order_id,
                "handler": function (response) {
                    window.location.href = "/payment-success/";
                }
            };
            new Razorpay(options).open();
        });
    };
});
</script>


</body>
</html>
